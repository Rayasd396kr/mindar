<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v6.1.0/dist/aframe-extras.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol@v0.74.0/dist/L.Control.Locate.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol@0.74.0/dist/L.Control.Locate.min.js" charset="utf-8"></script>
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>

    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
        }
        @keyframes slideDown {
            from {
                transform: translateY(100%);
            }
            to {
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                transform: translateY(-200%);
            }
            to {
                transform: translateY(0%);
            }
        }
        @keyframes mapdown {
            from {
                transform: translateY(0);
            }
            to {
                transform: translateY(100%);
            }
        }
        @keyframes mapup {
            from {
                transform: translateY(100%);
            }
            to {
                transform: translateY(0);
            }
        }
        #map {
            width: 100%;
            height: 30vh;
            position: fixed;
            bottom: 0;
            left: 0;
            z-index: 999;

            animation: mapup 0.5s forwards;

        }

        #map.slide-down {
            animation: slideDown 0.5s forwards;
        }

        #map.slide-up {
            animation: slideUp 0.5s forwards;
        }

        #map.show {
            animation: mapdown 0.5s forwards;
        }
        .map-toggle-icon {
            position: fixed;
            top: 100px;  
            right: 10px; 
            z-index: 1000;
            background-color: #307fb7;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px;
            cursor: pointer;
            font-size: 24px;
            transition: background-color 0.3s, color 0.3s; 
            width: 25px; 
            height: 25px; 
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .map-toggle-icon.active {
            background-color: #a49d9d; 
            color: white; 
        }
        .toggle-info-window {
            position: fixed;
            top: 160px;  
            right: 10px; 
            z-index: 1001;
            background-color: #307fb7;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px;
            cursor: pointer;
            font-size: 24px;
            width: 25px; 
            height: 25px; 
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .toggle-info-window.active {
            background-color: #a49d9d; 
            color: white; 
        }
        .custom-div-icon {
            text-align: center;
            font-size: 15px;
        }
        .custom-div-icon .circle {
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            width: 15px;
            height: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 2px solid #000;
            margin-bottom: 2px;
        }
        .custom-div-icon .text {
            position: relative;
            left: -15px;
        }
        .info-window {
            position: fixed;
            bottom: 31%;
            left: 50%;
            transform: translateX(-50%);
            width: 70%;
            background: white;
            border: 1px solid #ccc;
            padding: 10px;
            display: none;
            z-index: 1000;
            box-sizing: border-box;
            overflow: auto;
        }
        .info-window img {
            width: 80px;
            height: 80px;
            float: left;
            margin-right: 10px;
        }
        .info-window h3 {
            margin: 0;
        }
        .info-window p {
            margin: 5px 0;
        }
        .info-window button {
            display: block;
            background-color: rgb(125, 163, 192);
            color: white;
            border: none;
            font-size: 15px; 
            padding: 5px 10px;
            border-radius: 5px; 
        }

        .button-container {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            position: fixed;
            top: 10px;
            width: 100%;
            overflow-x: auto;
            z-index: 1001;
            white-space: nowrap;
            padding: 10px 0;
            box-sizing: border-box;
        }
        .button-container button {
            margin: 0 10px;
            padding: 10px 20px;
            border: none;
            background-color: #307fb7;
            color: white;
            border-radius: 15px;
            cursor: pointer;
            font-size: 16px;
            flex-shrink: 0;
        }
        .button-container::-webkit-scrollbar {
            display: none;
        }
        .zoom-button {
            position: absolute;
            bottom: 60px;
            right: 10px;
            z-index: 1000;
            background-color: #307fb7;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .swiper-container {
            position: absolute;
            bottom: 140px;
            right: 0px;
            width: 100%;
            height: 50vh;
            background-position: center;
            background-size: cover;
            border-radius: 10px;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .swiper-slide {
            text-align: center;
            background: rgba(116, 145, 155, 0.807);
            background-size: cover;
            background-position: center;
            width: 80%;
        }

        .swiper-slide .slide-content {
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
        }
        .swiper-slide img {
            display: block;
            max-width: 100%;
            max-height: 50%; 
            object-fit: cover; 
        }
        .slide-title {
            color: white;
            height: 10%; 
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .slide-text {
            padding: 0 5%;
            color: white;
            height: 20%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            color: white;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="button-container">
        <button onclick="toggleMarkers('navigation')">導覽路線</button>
        <button onclick="toggleMarkers('buildings')">大樓</button>
        <button onclick="toggleMarkers('offices')">處室</button>
        <button onclick="toggleMarkers('sports')">運動場</button>
        <button onclick="toggleMarkers('events')">活動</button>
        
    </div>

    <a-scene mindar-image="uiScanning: #example-scanning-overlay;filterMinCF:0.0001; filterBeta: 0.001;imageTargetSrc: https://raw.githubusercontent.com/Rayasd396kr/ar/main/t3.mind;" color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
        <a-camera position="0 0 0" look-controls="enabled: false" cursor="fuse: false; rayOrigin: mouse;" raycaster="far: ${customFields.libVersion}; objects: .clickable"></a-camera>
        <a-entity id="bearEntity" mindar-image-target="targetIndex: 0">
            <a-plane opacity="0.5" color="white" width="10" height="10" position="0 0 0"></a-plane>
            <a-text value="test" color="black" align="center" position="0 0 0"></a-text>
        </a-entity>
        <a-entity id="raccoonEntity" mindar-image-target="targetIndex: 1">
            <a-image src="https://raw.githubusercontent.com/Rayasd396kr/ar/main/a.png" position="0 1.2 0" scale="0.75 0.75 0.75"></a-image>
            <a-text id="clickable" value="Zcl" color="black" align="center" position="0 -0.5 0"></a-text>
            <a-gltf-model rotation="0 0 0 " position="0 -0.25 0" scale="1 1 1" src="https://raw.githubusercontent.com/Rayasd396kr/ar/main/zcl.glb" animation-mixer></a-gltf-model>
            <a-box id="button-left" class="clickable" color="black" width="0.7" height="0.3" depth="0.2" position="0 -0.8 0">
                <a-text value="introduce" align="center" color="white" position="0 0 0.1" scale="0.5 0.5 0.5"></a-text>
            </a-box>
        </a-entity>
        <a-entity>
            <a-box position="0 1.5 0" rotation="0 45 45" color="#4CC3D9"></a-box>
            <a-text value="Hello, AR World!" position="0 2 0" rotation="0 0 0" align="center" color="#FFFFFF"></a-text>
        </a-entity>
    </a-scene>
    <i class="fa-solid fa-map-location-dot map-toggle-icon" aria-hidden="true" onclick="toggleMap()"></i>
    <i class="fa-solid fa-file-lines toggle-info-window" id="toggle-info-window" aria-hidden="true" onclick="toggleinfo()"></i>
    <div id="map">
        <i class="fa fa-expand zoom-button" aria-hidden="true" onclick="toggleFullScreen()"></i>
    </div>
    <div id="info-window" class="info-window">
        <img id="info-image" src="" alt="Info Image">
        <div>
            <h3 id="info-title">Title</h3>
            <p id="info-description">Description</p>
            <button id="info-button" >Learn More</button>
        </div>
    </div>
    <div class="swiper-container">
        <div class="swiper-wrapper">
            <div class="swiper-slide">
                <div class="slide-content">
                    <span class="close-btn">&times;</span>
                    <h2 class="slide-title">1.資管四樓某地方</h2>
                    <img src="https://swiperjs.com/demos/images/nature-3.jpg" />
                    <p class="slide-text">此處是資管大本營，每個資管人都在此上過課，培養出很多優秀人才。</p>
                </div>
            </div>
            <div class="swiper-slide">
                <div class="slide-content">
                    <span class="close-btn">&times;</span>
                    <h2 class="slide-title">2.弘業樓</h2>
                    <img src="https://swiperjs.com/demos/images/nature-3.jpg" />
                    <p class="slide-text">此處是資管大本營，每個資管人都在此上過課，培養出很多優秀人才，此處是資管大本營</p>
                </div>
            </div>
            <div class="swiper-slide">
                <div class="slide-content">
                    <span class="close-btn">&times;</span>
                    <h2 class="slide-title">1.資管四樓某地方</h2>
                    <img src="https://swiperjs.com/demos/images/nature-3.jpg" />
                    <p class="slide-text">此處是資管大本營，每個資管人都在此上過課，培養出很多優秀人才。</p>
                </div>
            </div>
            <div class="swiper-slide">
                <div class="slide-content">
                    <span class="close-btn">&times;</span>
                    <h2 class="slide-title">1.資管四樓某地方</h2>
                    <img src="https://swiperjs.com/demos/images/nature-3.jpg" />
                    <p class="slide-text">此處是資管大本營，每個資管人都在此上過課，培養出很多優秀人才。</p>
                </div>
            </div>
            <div class="swiper-slide">
                <div class="slide-content">
                    <span class="close-btn">&times;</span>
                    <h2 class="slide-title">1.資管四樓某地方</h2>
                    <img src="https://swiperjs.com/demos/images/nature-3.jpg" />
                    <p class="slide-text">此處是資管大本營，每個資管人都在此上過課，培養出很多優秀人才。</p>
                </div>
            </div>
        </div>
    </div>
      

    <script>
        var map = L.map('map', { zoomControl: false }).setView([24.150996625919188, 120.68148734742584], 17);
        var markerLayer = L.layerGroup().addTo(map);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        var infoImage = document.getElementById('info-image');
        var infoTitle = document.getElementById('info-title');
        var infoDescription = document.getElementById('info-description');
        var infoButton = document.getElementById('info-button');
        var infoWindow = document.getElementById('info-window');

        var locations = {
            navigation: [
                { circle: "1", name: "行政&資訊樓", coords: [24.14961330934904, 120.68364591589136], image: 'https://raw.githubusercontent.com/Rayasd396kr/ar/main/zcl.png', title: '行政&資訊樓', description: '行政&資訊樓的描述', buttonText: '集點', slideIndex: 0  },
                { circle: "2", name: "中正樓", coords: [24.14960142559353, 120.68333783333679], image: 'https://raw.githubusercontent.com/Rayasd396kr/ar/main/zcl.png', title: '中正樓', description: '中正樓的描述', buttonText: '集點', slideIndex: 1},
                { circle: "3", name: "活動中心", coords: [24.15002756948417, 120.68259788356026], image: 'https://example.com/image3.jpg', title: '活動中心', description: '活動中心的描述', buttonText: '了解更多' },
                { circle: "4", name: "昌明樓", coords: [24.150397919894687, 120.68298858486425] },
                { circle: "5", name: "翰英樓", coords: [24.151290909932047, 120.68315169317616] },
                { circle: "6", name: "中商大樓", coords: [24.15123377909032, 120.68217149067684] },
                { circle: "7", name: "宿舍", coords: [24.151830165086253, 120.68329357159718] },
                { circle: "8", name: "奇秀樓", coords: [24.151224781813994, 120.68397935752898] },
                { circle: "9", name: "弘業樓", coords: [24.1505058854478, 120.68404953097337] },
                { circle: "10", name: "home", coords: [24.150996625919188, 120.68148734742584], image: 'https://raw.githubusercontent.com/Rayasd396kr/ar/main/zcl.png', title: 'home', description: '家的描述', buttonText: '集點', slideIndex: 1  }
            ],
            buildings: [
                { circle: "1", name: "行政&資訊樓", coords: [24.14961330934904, 120.68364591589136], image: 'https://raw.githubusercontent.com/Rayasd396kr/ar/main/zcl.png', title: '行政&資訊樓', description: '行政&資訊樓的描述', buttonText: '集點' },
                { circle: "2", name: "中正樓", coords: [24.14960142559353, 120.68333783333679], image: 'https://example.com/image2.jpg', title: '中正樓', description: '中正樓的描述', buttonText: '了解更多' },
                
            ],
            offices: [
                { circle: "3", name: "行政&資訊樓", coords: [24.14961330934904, 120.68364591589136], image: 'https://raw.githubusercontent.com/Rayasd396kr/ar/main/zcl.png', title: '行政&資訊樓', description: '行政&資訊樓的描述', buttonText: '集點' },
                { circle: "4", name: "中正樓", coords: [24.14960142559353, 120.68333783333679], image: 'https://example.com/image2.jpg', title: '中正樓', description: '中正樓的描述', buttonText: '了解更多' },

            ],
            sports: [
               
            ],
            events: [
               
            ]
        };

        var currentMarkers = null;
        var isNavigationActive = false;

        function toggleMarkers(type) {
            if (currentMarkers) {
                markerLayer.removeLayer(currentMarkers);
            }

            currentMarkers = L.layerGroup().addTo(markerLayer);
            locations[type].forEach(location => {
                var textMarker = L.divIcon({
                    className: 'custom-div-icon',
                    html: `<div class='circle'>${location.circle}</div><div class='text'>${location.name}</div>`,
                    iconSize: [50, 50],
                    iconAnchor: [15, 0]
                });

                L.marker(location.coords, { icon: textMarker }).addTo(currentMarkers);
            });
        }


        function clean() {
            if (markerLayer.getLayers().length > 0) {
                markerLayer.clearLayers(); 
            }
        }

        var lc = L.control.locate({
            setView: 'always',
            keepCurrentZoomLevel: true,
            locateOptions: {
                enableHighAccuracy: true
            },
            initialZoomLevel: 20
        }).addTo(map);

        lc.start();

        function updateInfoWindow(latlng) {
            var closestLocation = Object.values(locations).flat().reduce((closest, location) => {
                var distance = map.distance(latlng, location.coords);
                return distance < closest.distance ? { location, distance } : closest;
            }, { distance: Infinity }).location;

            if (map.distance(latlng, closestLocation.coords) < 50) { 
                infoImage.src = closestLocation.image || '';
                infoTitle.textContent = closestLocation.title || '';
                infoDescription.textContent = closestLocation.description || '';
                infoButton.textContent = closestLocation.buttonText || 'Learn More';
                infoButton.onclick = () => jumpToSlide(closestLocation.slideIndex || 0);
                infoWindow.style.display = 'block';
                
            } else {
                infoWindow.style.display = 'none';
            }
        }

        document.getElementById('toggle-info-window').addEventListener('click', function() {
            var infoWindow = document.getElementById('info-window');
            if (infoWindow.style.display === 'none' || infoWindow.style.display === '') {
                infoWindow.style.display = 'block';
            } else {
                infoWindow.style.display = 'none';
            }
        });
        document.addEventListener('DOMContentLoaded', (event) => {
            const closeButtons = document.querySelectorAll('.close-btn');
            const swiperContainer = document.querySelector('.swiper-container');

            closeButtons.forEach(button => {
                button.addEventListener('click', () => {
                    swiperContainer.style.display = 'none'; 
                });
            });

            document.getElementById('info-button').addEventListener('click', () => {
                if (swiperContainer.style.display === 'none' || swiperContainer.style.display === '') {
                    swiperContainer.style.display = 'block'; 
                    swiper.update();
                } else {
                    swiperContainer.style.display = 'none'; 
                }
            });
        });


        map.on('locationfound', function(e) {
            userLatLng = [e.latlng.lat, e.latlng.lng];
            updateInfoWindow(e.latlng);
        });

        function toggleFullScreen() {
            const mapElement = document.getElementById('map');
            const isFullScreen = mapElement.style.height === '100vh';

            if (isFullScreen) {
                mapElement.classList.add('slide-up');
                mapElement.classList.remove('slide-down');
                mapElement.style.height = '30vh';
                
                setTimeout(() => {
                    mapElement.style.position = 'fixed';
                    map.invalidateSize();
                    map.setView(userLatLng, map.getZoom());
                }, 500);

                document.querySelector('.content').style.paddingTop = '30vh';
            } else {
                mapElement.classList.add('slide-down');
                mapElement.classList.remove('slide-up');
                mapElement.style.height = '100vh';

                setTimeout(() => {
                    map.invalidateSize();
                    map.setView(userLatLng, map.getZoom());
                }, 500);

                document.querySelector('.content').style.paddingTop = '100vh';
            }
        }


        function toggleMap() {
            var mapElement = document.getElementById('map');
            var mapToggleIcon = document.querySelector('.map-toggle-icon');
            mapElement.classList.remove('slide-up');
            mapElement.classList.remove('slide-down');
            mapElement.classList.toggle('show');
            mapToggleIcon.classList.toggle('active');
        }
        function toggleinfo(){
            var infoToggleIcon = document.querySelector('.toggle-info-window');
            infoToggleIcon.classList.toggle('active');
        }
        var swiper = new Swiper('.swiper-container', {
            effect: 'coverflow',
            grabCursor: true,
            centeredSlides: true,
            slidesPerView: 'auto',
            coverflowEffect: {
            rotate: 50,
            stretch: 0,
            depth: 100,
            modifier: 1,
            slideShadows: true,
            },
            pagination: {
            el: '.swiper-pagination',
            clickable: true,
            },
        });
        function jumpToSlide(index) {
            swiper.slideTo(index);
        }
    </script>
</body>
</html>
