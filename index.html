<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Geolocation and Orientation with OpenLayers</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@latest/ol.css" type="text/css">
  <style>
    .map {
      height: 100vh;
      width: 100%;
    }
    .user-marker {
      width: 50px;
      height: 50px;
      background: url('https://upload.wikimedia.org/wikipedia/commons/e/ec/RedDot.svg') no-repeat center;
      background-size: cover;
      transform-origin: center;
    }
  </style>
</head>
<body>
  <div id="map" class="map"></div>
  <script src="https://cdn.jsdelivr.net/npm/ol@latest/dist/ol.js"></script>
  <script>
    // Create map and base layer
    const map = new ol.Map({
      target: 'map',
      layers: [
        new ol.layer.Tile({
          source: new ol.source.OSM()
        })
      ],
      view: new ol.View({
        center: ol.proj.fromLonLat([0, 0]),
        zoom: 15
      })
    });

    // Create user marker
    const userIconElement = document.createElement('div');
    userIconElement.className = 'user-marker';

    const userMarker = new ol.Overlay({
      positioning: 'center-center',
      element: userIconElement,
      stopEvent: false
    });
    map.addOverlay(userMarker);

    // Update user position
    const updateUserPosition = (coords) => {
      const { latitude, longitude } = coords;
      const position = ol.proj.fromLonLat([longitude, latitude]);
      userMarker.setPosition(position);
      map.getView().setCenter(position);
    };

    // Track user's location
    if ('geolocation' in navigator) {
      navigator.geolocation.watchPosition((position) => {
        updateUserPosition(position.coords);
      }, (error) => {
        console.error('Geolocation error:', error);
      }, {
        enableHighAccuracy: true,
        maximumAge: 0,
        timeout: 27000
      });
    } else {
      alert('Geolocation not supported');
    }

    // Update user orientation
    if (window.DeviceOrientationEvent) {
      window.addEventListener('deviceorientation', (event) => {
        if (event.alpha !== null) {
          const heading = (360 - event.alpha) % 360;
          userIconElement.style.transform = `rotate(${heading}deg)`;
        }
      }, true);
    } else {
      alert('Device Orientation not supported');
    }
  </script>
</body>
</html>
